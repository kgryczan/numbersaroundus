<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Numbers around us">
<meta name="dcterms.date" content="2024-08-23">

<title>SQL of the Rings: One Language to Query Them All (with R) – Numbers Around Us</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-cb71375167fd9ce754afb6fa31d3f44e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-1a65b4115a9519dac2c2f4ba2497ca08.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Numbers Around Us</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../challenges/index.html"> 
<span class="menu-text">Challenges</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bi/index.html"> 
<span class="menu-text">Business Intelligence</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ds/index.html"> 
<span class="menu-text">Data Science</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dp/index.html"> 
<span class="menu-text">Date Philosophy</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com" title="Github" class="quarto-navigation-tool px-1" aria-label="Github"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SQL of the Rings: One Language to Query Them All (with R)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Numbers around us </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="concise-tutorial-for-r-database-interfaces" class="level3">
<h3 class="anchored" data-anchor-id="concise-tutorial-for-r-database-interfaces">Concise Tutorial for R Database Interfaces</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sql-ring.jpg" class="img-fluid figure-img"></p>
<figcaption>Image</figcaption>
</figure>
</div>
<p>In the vast and intricate world of data, much like the realms of Middle-earth, there lies a powerful force — SQL, the language of databases. SQL (Structured Query Language) has long been the One Language to query them all, a tool that allows us to retrieve, manipulate, and manage the vast treasures of information stored within our databases. But like any great power, its true potential is unlocked only when wielded wisely.</p>
<p>Enter R, the versatile and mighty language of data analysis, statistics, and visualization. R is to data scientists what the Elven rings were to their bearers — a tool of great influence, allowing them to perform incredible feats of analysis, prediction, and insight. However, as potent as R is, it cannot rule the world of data alone. The true power lies in the harmonious combination of R and SQL, much like the fellowship that united to confront the challenges of Middle-earth.</p>
<p>In this article, we start a journey — a quest, if you will — through the realms of SQL and R. Together, we will explore how these two powerful tools can be united to master the ever-growing landscape of data. Whether you are an analyst delving into complex datasets, a data scientist crafting predictive models, or a developer integrating data pipelines, the synergy of SQL and R will guide you to new heights of efficiency and insight.</p>
<p>We begin our journey by learning how to connect R to various databases, akin to unlocking the gates of Moria. We will then delve into the art of crafting secure and efficient queries, reminiscent of the dwarves forging tools in the depths of their mines. As we progress, we will harness the power of <code>dbplyr</code>—the One Interface that binds the simplicity of <code>dplyr</code> with the might of SQL. Along the way, we will face challenges, such as battling large datasets, and discover techniques to emerge victorious.</p>
<p>Finally, we will touch upon the ancient art of Object-Relational Mapping (ORM), a method of wielding SQL’s power with the precision of R6 object-oriented programming, akin to forging your own rings of power.</p>
<p>So, gather your courage and prepare your tools, for we are about to embark on an epic adventure — one that will unlock the full potential of SQL and R, and elevate your data analysis to legendary status.</p>
</section>
<section id="speak-friend-and-enter-connecting-r-to-your-databases" class="level3">
<h3 class="anchored" data-anchor-id="speak-friend-and-enter-connecting-r-to-your-databases">Speak, Friend, and Enter: Connecting R to Your Databases</h3>
<p>Every great journey begins with a single step, and in our quest to master SQL in R, that step is establishing a connection to our database. Just as the Fellowship needed to speak the password to open the Gates of Moria, we must correctly configure our connections to access the treasures of data stored within our databases.</p>
<p>In R, the key to these gates lies in the <code>DBI</code> package, a robust and consistent interface for connecting to a variety of Database Management Systems (DBMS). Whether you’re delving into the depths of an SQLite file, managing the sprawling realms of a MariaDB instance, or exploring the lightning-fast DuckDB, <code>DBI</code> and its companion drivers will guide you through.</p>
<section id="connecting-to-sqlite-the-ancient-repository" class="level4">
<h4 class="anchored" data-anchor-id="connecting-to-sqlite-the-ancient-repository">Connecting to SQLite: The Ancient Repository</h4>
<p>SQLite is the equivalent of an ancient Dwarven repository — compact, self-contained, and requiring no external server. It’s perfect for projects where you need a lightweight, portable database that’s easy to manage.</p>
<p>Here’s how you can connect to an SQLite database in R:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish a connection to the SQLite database</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>con_sqlite <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">dbname =</span> <span class="st">"my_database.sqlite"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check connection</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(con_sqlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This simple command opens the gate to your SQLite database, allowing you to explore its contents, query its tables, and manipulate its data — all from within R.</p>
</section>
<section id="connecting-to-mariadb-the-kingdom-of-data" class="level4">
<h4 class="anchored" data-anchor-id="connecting-to-mariadb-the-kingdom-of-data">Connecting to MariaDB: The Kingdom of Data</h4>
<p>For larger, more complex datasets requiring a scalable, server-based solution, MariaDB is the kingdom where your data resides. MariaDB, a powerful fork of MySQL, is well-suited for enterprise-level applications, offering robust performance and extensive features.</p>
<p>Connecting to MariaDB in R is straightforward with the <code>RMariaDB</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish a connection to the MariaDB database</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>con_mariadb <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RMariaDB<span class="sc">::</span><span class="fu">MariaDB</span>(), </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dbname =</span> <span class="st">"your_database_name"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">host =</span> <span class="st">"localhost"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">user =</span> <span class="st">"your_username"</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">password =</span> <span class="st">"your_password"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check connection</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(con_mariadb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this connection, you gain access to the vast resources of your MariaDB database, ready to be queried and analyzed.</p>
</section>
<section id="connecting-to-duckdb-the-speed-of-a-ranger" class="level4">
<h4 class="anchored" data-anchor-id="connecting-to-duckdb-the-speed-of-a-ranger">Connecting to DuckDB: The Speed of a Ranger</h4>
<p>DuckDB is the ranger of the database world — swift, efficient, and designed for rapid analytical queries. It’s a great choice when you need to process large datasets on the fly, without the overhead of traditional database management systems.</p>
<p>Here’s how you can connect to DuckDB in R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Establish a connection to the DuckDB database</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>con_duckdb <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), <span class="at">dbdir =</span> <span class="st">"my_database.duckdb"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check connection</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(con_duckdb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With DuckDB, you can traverse large datasets with the speed and agility of a ranger, executing complex queries in a fraction of the time it might take with other systems.</p>
</section>
<section id="closing-the-gate-disconnecting-from-databases" class="level4">
<h4 class="anchored" data-anchor-id="closing-the-gate-disconnecting-from-databases">Closing the Gate: Disconnecting from Databases</h4>
<p>Just as it’s important to close the Gates of Moria once the Fellowship has passed through, it’s essential to properly close your database connections when you’re done. This ensures that resources are freed and that you maintain a good practice of managing your connections.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect from SQLite</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con_sqlite)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect from MariaDB</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con_mariadb)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect from DuckDB</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con_duckdb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By mastering the art of database connections in R, you’re well on your way to unlocking the full potential of SQL and R. With the gates open, you’re ready to explore the data that lies within.</p>
</section>
</section>
<section id="forging-secure-queries-in-the-mines-of-moria" class="level3">
<h3 class="anchored" data-anchor-id="forging-secure-queries-in-the-mines-of-moria">Forging Secure Queries in the Mines of Moria</h3>
<p>As we venture deeper into the world of data, it’s essential to equip ourselves with the right tools — much like the Dwarves of Moria, who crafted their mighty weapons and armor in the deep mines. In the realm of SQL and R, these tools are encapsulated within the <code>DBI</code> package, which allows us to perform operations on our databases securely and efficiently.</p>
<section id="forging-queries-with-dbexecute-and-dbgetquery" class="level4">
<h4 class="anchored" data-anchor-id="forging-queries-with-dbexecute-and-dbgetquery">Forging Queries with <code>dbExecute</code> and <code>dbGetQuery</code></h4>
<p>Two of the most fundamental tools in our SQL arsenal are <code>dbExecute</code> and <code>dbGetQuery</code>. These functions allow us to run SQL commands directly from R, retrieving or modifying data as needed.</p>
<ul>
<li><strong><code>dbGetQuery</code></strong>: This function is used to execute SQL SELECT queries, retrieving data from the database and returning it as a data frame in R.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve data from a table</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_mariadb, <span class="st">"SELECT * FROM users WHERE age &gt; 30"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>dbExecute</code></strong>: This function is used for SQL commands that modify the database, such as INSERT, UPDATE, or DELETE statements.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Insert a new record into the users table</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con_mariadb, <span class="st">"INSERT INTO users (name, age) VALUES ('Aragorn', 87)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These tools, while powerful, must be wielded with care. Just as the Dwarves took great care in forging their weapons, we must ensure that our queries are secure and efficient.</p>
</section>
<section id="securing-queries-with-dbbind" class="level4">
<h4 class="anchored" data-anchor-id="securing-queries-with-dbbind">Securing Queries with <code>dbBind</code></h4>
<p>In the Mines of Moria, the Dwarves faced many dangers, some of their own making. Similarly, careless use of SQL queries can expose your database to significant risks, particularly SQL injection attacks. This is where <code>dbBind</code> comes in—offering a way to securely bind parameters to your SQL queries, preventing malicious inputs from wreaking havoc.</p>
<p>Here’s how you can use <code>dbBind</code> to safely insert user data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Securely insert data using parameterized queries</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"INSERT INTO users (name, age) VALUES (?, ?)"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con_mariadb, query, <span class="at">params =</span> <span class="fu">list</span>(<span class="st">"Frodo"</span>, <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By using <code>dbBind</code>, you ensure that inputs are properly escaped and handled, much like a Dwarven smith ensuring that their forge is safe from disaster.</p>
</section>
<section id="crafting-complex-queries" class="level4">
<h4 class="anchored" data-anchor-id="crafting-complex-queries">Crafting Complex Queries</h4>
<p>Just as the Dwarves crafted intricate weapons, you can use SQL to build complex, multi-step queries. These might involve subqueries, joins, or aggregations — allowing you to derive powerful insights from your data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of a complex query using JOIN</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT users.name, COUNT(orders.id) AS order_count</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM users</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN orders ON users.id = orders.user_id</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY users.name</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">  HAVING COUNT(orders.id) &gt; 5</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_mariadb, query)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With these tools in hand, you are well-equipped to navigate the depths of your database, uncovering insights and forging a path through the data with the precision and skill of a master craftsman.</p>
</section>
</section>
<section id="one-interface-to-bind-them-all-dbplyr-and-the-power-of-dplyr-in-databases" class="level3">
<h3 class="anchored" data-anchor-id="one-interface-to-bind-them-all-dbplyr-and-the-power-of-dplyr-in-databases">One Interface to Bind Them All: <code>dbplyr</code> and the Power of <code>dplyr</code> in Databases</h3>
<p>In the saga of our data journey, <code>dbplyr</code> emerges as the One Interface to bind the simplicity of <code>dplyr</code> with the might of SQL. Much like the One Ring in Tolkien’s epic, <code>dbplyr</code> unites the strengths of different realms—in this case, the worlds of R and SQL—allowing us to perform powerful data manipulations without ever leaving the comfort of R’s syntax.</p>
<section id="harnessing-the-power-of-dbplyr" class="level4">
<h4 class="anchored" data-anchor-id="harnessing-the-power-of-dbplyr">Harnessing the Power of <code>dbplyr</code></h4>
<p><code>dbplyr</code> acts as a bridge, translating <code>dplyr</code> commands into SQL queries that are executed directly on the database. This means you can leverage the tidyverse’s intuitive syntax while still harnessing the full power of SQL under the hood.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reference a table in the database using `tbl()`</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>users_db <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_mariadb, <span class="st">"users"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a `dplyr` operation (automatically translated to SQL)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> users_db <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, age) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(age)) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, the <code>dplyr</code> operations are seamlessly converted into SQL, executed on the database, and the results are returned to R. This allows you to work efficiently with large datasets, keeping data processing within the database until you need to bring the results into R.</p>
</section>
<section id="seeing-the-sql-behind-the-magic-show_query" class="level4">
<h4 class="anchored" data-anchor-id="seeing-the-sql-behind-the-magic-show_query">Seeing the SQL Behind the Magic: <code>show_query()</code></h4>
<p>One of the great powers of <code>dbplyr</code> is its transparency—you can see exactly what SQL is being generated by your <code>dplyr</code> commands. This is where the <code>show_query()</code> function comes into play, revealing the SQL code that will be executed on your database.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `show_query()` to see the SQL query that `dplyr` generates</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>users_db <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, age) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(age)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>SQL<span class="sc">&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>SELECT <span class="st">`</span><span class="at">name</span><span class="st">`</span>, <span class="st">`</span><span class="at">age</span><span class="st">`</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>FROM <span class="st">`</span><span class="at">users</span><span class="st">`</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>WHERE <span class="st">`</span><span class="at">age</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="fl">30.0</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>ORDER BY <span class="st">`</span><span class="at">age</span><span class="st">`</span> DESC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This output shows the exact SQL query that <code>dbplyr</code> has generated based on your <code>dplyr</code> code. This transparency is invaluable for debugging, optimizing queries, and understanding how your data manipulations translate into SQL.</p>
</section>
<section id="securing-your-queries-with-glue_sql" class="level4">
<h4 class="anchored" data-anchor-id="securing-your-queries-with-glue_sql">Securing Your Queries with <code>glue_sql</code></h4>
<p>While <code>dbplyr</code> offers a powerful interface, there are times when you might need to write custom SQL queries directly. When doing so, it’s crucial to ensure these queries are secure, especially if they include user inputs. This is where <code>glue_sql</code> from the <code>glue</code> package comes in—offering a way to safely construct SQL queries by automatically escaping inputs.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of using `glue_sql` to create a safe query</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>age_threshold <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">glue_sql</span>(<span class="st">"SELECT * FROM users WHERE age &gt; {age_threshold}"</span>, <span class="at">.con =</span> con_mariadb)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con_mariadb, query)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, <code>glue_sql</code> ensures that user inputs are safely handled, much like the One Ring carefully managed by those who understand its power.</p>
<p>With <code>dbplyr</code> as your guide, you can harness the full potential of SQL within R, while maintaining the clarity and simplicity that the tidyverse is known for. By using <code>show_query()</code>, you gain insight into the underlying SQL, giving you the control to optimize and refine your data manipulations.</p>
</section>
</section>
<section id="council-of-elrond-techniques-for-querying-with-dplyr-and-friends" class="level3">
<h3 class="anchored" data-anchor-id="council-of-elrond-techniques-for-querying-with-dplyr-and-friends">Council of Elrond: Techniques for Querying with <code>dplyr</code> and Friends</h3>
<p>At the Council, the wisest and most experienced characters gathered to strategize for the journey ahead. Similarly, when working with SQL in R, it’s important to gather and leverage the best tools and techniques for querying your data. In this chapter, we’ll explore how to use <code>dplyr</code>, <code>dbplyr</code>, and other tidyverse packages to execute powerful and efficient queries, drawing from the wisdom of these tools to unlock the full potential of your data.</p>
<section id="basic-data-manipulations-with-dplyr-and-dbplyr" class="level4">
<h4 class="anchored" data-anchor-id="basic-data-manipulations-with-dplyr-and-dbplyr">Basic Data Manipulations with <code>dplyr</code> and <code>dbplyr</code></h4>
<p><code>dplyr</code> provides a suite of functions designed to simplify data manipulation, and with <code>dbplyr</code>, these same functions can be applied directly to data stored in a database. This approach allows you to work with large datasets efficiently, keeping the heavy lifting on the database server until you’re ready to bring the results into R.</p>
<p>Here are some of the fundamental <code>dplyr</code> functions you can use with <code>dbplyr</code>:</p>
<ul>
<li><strong><code>filter()</code></strong>: Subset rows based on conditions.</li>
<li><strong><code>select()</code></strong>: Choose specific columns to return.</li>
<li><strong><code>mutate()</code></strong>: Create new columns or modify existing ones.</li>
<li><strong><code>summarize()</code></strong>: Aggregate data, often combined with <code>group_by()</code>.</li>
<li><strong><code>arrange()</code></strong>: Sort data based on one or more columns.</li>
</ul>
<p><strong>Example</strong>: Suppose you have a table of users, and you want to find the names and ages of users who are older than 30, ordered by age.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>users_db <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_mariadb, <span class="st">"users"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> users_db <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, age) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(age)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, the <code>dplyr</code> commands are automatically translated into SQL queries, executed on the database, and the results are returned to R.</p>
</section>
<section id="advanced-query-techniques-joins-subqueries-and-more" class="level4">
<h4 class="anchored" data-anchor-id="advanced-query-techniques-joins-subqueries-and-more">Advanced Query Techniques: Joins, Subqueries, and More</h4>
<p>In many cases, data analysis requires more than just basic filtering and selection. You might need to combine data from multiple tables, perform calculations, or execute complex subqueries. <code>dplyr</code> and <code>dbplyr</code> provide functions that make these operations straightforward and readable.</p>
<p><strong>Joins</strong>: Combining data from two or more tables based on a common key is a frequent operation in SQL. <code>dplyr</code> offers a range of join functions (<code>inner_join</code>, <code>left_join</code>, <code>right_join</code>, <code>full_join</code>) that are easy to use and understand.</p>
<p><strong>Example</strong>: Joining two tables, <code>users</code> and <code>orders</code>, to find out which users have placed orders.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>orders_db <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_mariadb, <span class="st">"orders"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> users_db <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(orders_db, <span class="at">by =</span> <span class="st">"user_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, order_id, order_date) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Subqueries</strong>: Sometimes, you need to create a query that is based on the results of another query. <code>dplyr</code> allows you to nest operations, which <code>dbplyr</code> then translates into subqueries in SQL.</p>
<p><strong>Example</strong>: Finding users who have placed more than five orders.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> orders_db <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(user_id) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">order_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(order_count <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(users_db, <span class="at">by =</span> <span class="st">"user_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, order_count) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By gathering the wisdom of <code>dplyr</code>, <code>dbplyr</code>, and other tidyverse tools, you’re equipped to handle even the most complex data queries with elegance and power—just as the Council of Elrond strategized to overcome the challenges of Middle-earth.</p>
</section>
</section>
<section id="you-shall-not-pass-handling-large-datasets-with-r-and-sql" class="level3">
<h3 class="anchored" data-anchor-id="you-shall-not-pass-handling-large-datasets-with-r-and-sql">You Shall Not Pass: Handling Large Datasets with R and SQL</h3>
<p>In the depths of Khazad-dûm, the Fellowship faced one of their greatest challenges — the Balrog, a monstrous being of fire and shadow. Similarly, in the world of data, large datasets can present formidable obstacles, threatening to overwhelm your system’s memory and processing capabilities. But just as Gandalf stood firm against the Balrog, wielding his power to protect the Fellowship, you can leverage R and SQL to handle massive datasets efficiently and effectively.</p>
<section id="why-use-databases-for-large-datasets" class="level4">
<h4 class="anchored" data-anchor-id="why-use-databases-for-large-datasets">Why Use Databases for Large Datasets?</h4>
<p>When working with large datasets, the limitations of in-memory processing in R become apparent. R’s data frames, while powerful for smaller datasets, can quickly exhaust available memory when handling millions of rows or complex operations. This is where SQL databases excel — by keeping data on disk and only processing what’s necessary, databases can handle much larger datasets without the same memory constraints.</p>
</section>
<section id="chunked-processing-breaking-the-problem-into-manageable-pieces" class="level4">
<h4 class="anchored" data-anchor-id="chunked-processing-breaking-the-problem-into-manageable-pieces">Chunked Processing: Breaking the Problem into Manageable Pieces</h4>
<p>One of the key techniques for working with large datasets in R is chunked processing. Instead of loading the entire dataset into memory, you can process it in smaller, more manageable chunks. This approach is particularly useful when you’re performing operations that don’t require access to the entire dataset at once, such as filtering, aggregating, or writing results incrementally.</p>
<p><strong>Example</strong>: Suppose you have a large table of transactions and you want to calculate the total sales for each product. Instead of loading the entire table into R, you can process it in chunks:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume transactions_db is a large table in your database</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>transactions_db <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con_mariadb, <span class="st">"transactions"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to process each chunk</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>process_chunk <span class="ot">&lt;-</span> <span class="cf">function</span>(chunk) {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  chunk <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(product_id) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_sales =</span> <span class="fu">sum</span>(sales_amount)) <span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect</span>()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a loop or a functional approach to process the table in chunks</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, n_chunks)) {</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  chunk <span class="ot">&lt;-</span> transactions_db <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(chunk_id <span class="sc">==</span> i)  <span class="co"># Assuming chunk_id is a column that segments the data</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  results[[i]] <span class="ot">&lt;-</span> <span class="fu">process_chunk</span>(chunk)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the results from all chunks</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>final_result <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach ensures that each chunk is processed independently, avoiding memory overload and making it possible to work with very large datasets.</p>
</section>
<section id="leveraging-database-power-keeping-the-heavy-lifting-on-the-server" class="level4">
<h4 class="anchored" data-anchor-id="leveraging-database-power-keeping-the-heavy-lifting-on-the-server">Leveraging Database Power: Keeping the Heavy Lifting on the Server</h4>
<p>Another strategy for handling large datasets is to push as much computation as possible to the database server. SQL is designed for efficient data processing, so by using <code>dbplyr</code> to perform operations directly on the database, you can take full advantage of the database’s capabilities.</p>
<p><strong>Example</strong>: Calculating the total sales for each product directly on the database:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> transactions_db <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(product_id) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_sales =</span> <span class="fu">sum</span>(sales_amount)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, the aggregation is performed entirely on the database, minimizing the amount of data that needs to be transferred to R and reducing the load on R’s memory.</p>
</section>
<section id="emerging-victorious-from-the-battle" class="level4">
<h4 class="anchored" data-anchor-id="emerging-victorious-from-the-battle">Emerging Victorious from the Battle</h4>
<p>By combining the strengths of R and SQL, you can tackle even the most challenging datasets with confidence. Whether through chunked processing, leveraging the database’s power, or using a combination of both, you can ensure that large datasets do not become insurmountable obstacles. Just as Gandalf’s stand against the Balrog allowed the Fellowship to continue their journey, these techniques will allow you to continue your data analysis journey, no matter how large the datasets you encounter.</p>
</section>
</section>
<section id="reclaiming-the-throne-deploying-sql-and-r-in-production" class="level3">
<h3 class="anchored" data-anchor-id="reclaiming-the-throne-deploying-sql-and-r-in-production">Reclaiming the Throne: Deploying SQL and R in Production</h3>
<p>After the epic battles have been fought and the dust has settled, the time comes for the rightful king to take his place on the throne, restoring order to the realm. Similarly, once you’ve developed your data analysis and processing workflows using SQL and R, the next step is to deploy these workflows into production, ensuring they run smoothly, reliably, and securely. In this chapter, we’ll explore how to take your SQL and R solutions from development to production, much like the return of Aragorn to reclaim his kingdom.</p>
<section id="building-automated-data-pipelines" class="level4">
<h4 class="anchored" data-anchor-id="building-automated-data-pipelines">Building Automated Data Pipelines</h4>
<p>In a production environment, data workflows often need to run on a regular schedule — whether it’s updating reports, refreshing data models, or performing routine data transformations. Building automated data pipelines ensures that these tasks are executed consistently and without manual intervention.</p>
<p><strong>Scheduling Scripts</strong>: One of the simplest ways to automate R scripts that use SQL is to schedule them with tools like <code>cron</code> (on Unix-based systems) or Task Scheduler (on Windows). These tools allow you to specify when and how often your scripts should run.</p>
<p><strong>Example</strong>: A cron job to run an R script daily at midnight.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="dv">0</span> <span class="sc">*</span> <span class="er">*</span> <span class="er">*</span> <span class="er">/</span>usr<span class="sc">/</span>bin<span class="sc">/</span>Rscript <span class="sc">/</span>path<span class="sc">/</span>to<span class="sc">/</span>your_script.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Using RStudio Connect</strong>: RStudio Connect is a powerful platform that allows you to deploy R scripts, Shiny apps, and R Markdown documents. It provides scheduling capabilities, version control, and easy sharing with stakeholders.</p>
<p><strong>Example</strong>: Deploying an R Markdown report that queries a database and generates daily summaries.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">render</span>(<span class="st">"daily_report.Rmd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="managing-database-credentials-securely" class="level4">
<h4 class="anchored" data-anchor-id="managing-database-credentials-securely">Managing Database Credentials Securely</h4>
<p>When deploying SQL and R workflows in production, it’s crucial to manage database credentials securely. Hardcoding usernames and passwords in your scripts is risky, as it can lead to unauthorized access if the script is shared or exposed.</p>
<p><strong>Environment Variables</strong>: Store sensitive information like database credentials in environment variables. This keeps them out of your code and allows you to change them easily without modifying your scripts.</p>
<p><strong>Example</strong>: Accessing database credentials from environment variables in R.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>db_user <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_USER"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>db_password <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"DB_PASSWORD"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>con_mariadb <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RMariaDB<span class="sc">::</span><span class="fu">MariaDB</span>(), </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dbname =</span> <span class="st">"your_database_name"</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">host =</span> <span class="st">"localhost"</span>, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">user =</span> db_user, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">password =</span> db_password)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Configuration Files</strong>: Another approach is to use a configuration file, such as <code>config.yml</code>, to store your database settings. The <code>config</code> package in R makes it easy to read and use these settings in your scripts.</p>
<p><strong>Example</strong>: Using the <code>config</code> package to manage database configurations.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(config)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>db_config <span class="ot">&lt;-</span> config<span class="sc">::</span><span class="fu">get</span>(<span class="st">"database"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>con_mariadb <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RMariaDB<span class="sc">::</span><span class="fu">MariaDB</span>(), </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dbname =</span> db_config<span class="sc">$</span>dbname, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">host =</span> db_config<span class="sc">$</span>host, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">user =</span> db_config<span class="sc">$</span>user, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">password =</span> db_config<span class="sc">$</span>password)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="monitoring-and-maintenance" class="level4">
<h4 class="anchored" data-anchor-id="monitoring-and-maintenance">Monitoring and Maintenance</h4>
<p>Once your SQL and R workflows are in production, ongoing monitoring and maintenance are essential to ensure they continue to run smoothly.</p>
<ul>
<li><strong>Monitoring</strong>: Set up alerts and monitoring tools to notify you if a script fails, if a database becomes unreachable, or if performance issues arise. This allows you to respond quickly and minimize downtime.</li>
<li><strong>Regular Updates</strong>: Keep your R environment and packages up to date, but be cautious with major updates that might introduce breaking changes. Test updates in a development environment before deploying them to production.</li>
</ul>
<p>By following these best practices, you can deploy your SQL and R workflows into production with confidence, knowing that they are secure, reliable, and maintainable. Just as Aragorn restored order to the kingdom, you can ensure that your data processes run smoothly, delivering consistent and accurate results to your stakeholders.</p>
</section>
</section>
<section id="forging-your-own-rings-implementing-orm-with-r6-in-r" class="level3">
<h3 class="anchored" data-anchor-id="forging-your-own-rings-implementing-orm-with-r6-in-r">Forging Your Own Rings: Implementing ORM with R6 in R</h3>
<p>In the realm of Middle-earth, the Rings of Power were forged to bring order and control over the different races, each ring granting its bearer immense power and influence. Similarly, in the world of data, Object-Relational Mapping (ORM) can be thought of as a powerful tool that brings order and control over database interactions, allowing developers to work with databases using familiar object-oriented principles.</p>
<p>In this chapter, we’ll explore how to implement a simple ORM system in R using R6 classes, which can encapsulate database operations within objects. This approach not only streamlines the interaction with databases but also makes your code more modular, reusable, and easier to maintain.</p>
<section id="introduction-to-orm" class="level4">
<h4 class="anchored" data-anchor-id="introduction-to-orm">Introduction to ORM</h4>
<p>ORM is a technique that allows you to interact with a database by mapping tables to classes, rows to objects, and columns to attributes. This abstraction makes it easier to manage database interactions within your application, as you can work with objects and methods rather than writing raw SQL queries.</p>
<ul>
<li><strong>Why Use ORM?</strong>: ORM simplifies database operations by encapsulating them within objects, making your code more intuitive and less error-prone. It also provides a layer of abstraction that can make your application more portable across different database systems.</li>
</ul>
</section>
<section id="setting-up-r6-classes-forging-the-rings" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-r6-classes-forging-the-rings">Setting Up R6 Classes: Forging the Rings</h4>
<p>R6 classes in R provide a framework for creating object-oriented structures, where you can define methods (functions) and fields (attributes) that correspond to your database operations. Let’s start by creating an R6 class that represents a simple <code>User</code> object, corresponding to a <code>users</code> table in a database.</p>
<p><strong>Step 1: Define the R6 Class</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the User class</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>User <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(<span class="st">"User"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">con =</span> <span class="cn">NULL</span>,  <span class="co"># Database connection</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">table_name =</span> <span class="st">"users"</span>,  <span class="co"># Table name</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(con) {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>con <span class="ot">&lt;-</span> con</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method to create a new user</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">create =</span> <span class="cf">function</span>(name, age) {</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dbExecute</span>(self<span class="sc">$</span>con, </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="st">"INSERT INTO"</span>, self<span class="sc">$</span>table_name, <span class="st">"(name, age) VALUES (?, ?)"</span>), </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">params =</span> <span class="fu">list</span>(name, age))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method to find a user by ID</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">find_by_id =</span> <span class="cf">function</span>(user_id) {</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(self<span class="sc">$</span>con, </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">paste</span>(<span class="st">"SELECT * FROM"</span>, self<span class="sc">$</span>table_name, <span class="st">"WHERE id = ?"</span>, user_id))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(result)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method to update a user's age</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">update_age =</span> <span class="cf">function</span>(user_id, new_age) {</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dbExecute</span>(self<span class="sc">$</span>con, </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="st">"UPDATE"</span>, self<span class="sc">$</span>table_name, <span class="st">"SET age = ? WHERE id = ?"</span>), </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">params =</span> <span class="fu">list</span>(new_age, user_id))</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method to delete a user by ID</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">delete =</span> <span class="cf">function</span>(user_id) {</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dbExecute</span>(self<span class="sc">$</span>con, </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="st">"DELETE FROM"</span>, self<span class="sc">$</span>table_name, <span class="st">"WHERE id = ?"</span>), </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">params =</span> <span class="fu">list</span>(user_id))</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method to list all users</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">list_all =</span> <span class="cf">function</span>() {</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(self<span class="sc">$</span>con, </span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">paste</span>(<span class="st">"SELECT * FROM"</span>, self<span class="sc">$</span>table_name))</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(result)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This class encapsulates basic CRUD (Create, Read, Update, Delete) operations for a <code>users</code> table. Each method corresponds to a database operation, making it easier to interact with the database without writing raw SQL in your main application code.</p>
<p><strong>Step 2: Using the R6 Class</strong> Now that we have our <code>User</code> class, we can use it to manage users in the database.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to a database</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RMariaDB<span class="sc">::</span><span class="fu">MariaDB</span>(), </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">"your_database_name"</span>, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="st">"localhost"</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user =</span> <span class="st">"your_username"</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="st">"your_password"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new User object</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> User<span class="sc">$</span><span class="fu">new</span>(con)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new user</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>user<span class="sc">$</span><span class="fu">create</span>(<span class="st">"Frodo Baggins"</span>, <span class="dv">50</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Find a user by ID</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>frodo <span class="ot">&lt;-</span> user<span class="sc">$</span><span class="fu">find_by_id</span>(<span class="dv">1</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(frodo)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  id          name age</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#1  1 Frodo Baggins  50</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Update a user's age</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>user<span class="sc">$</span><span class="fu">update_age</span>(<span class="dv">1</span>, <span class="dv">51</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete a user by ID</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>user<span class="sc">$</span><span class="fu">delete</span>(<span class="dv">1</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co"># List all users</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>all_users <span class="ot">&lt;-</span> user<span class="sc">$</span><span class="fu">list_all</span>()</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_users)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect from the database</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this setup, you can easily manage users in your database using simple method calls, much like wielding a Ring of Power. The operations are intuitive, encapsulated within the object, and shielded from the complexity of raw SQL.</p>
</section>
<section id="extending-the-orm-forging-additional-rings" class="level4">
<h4 class="anchored" data-anchor-id="extending-the-orm-forging-additional-rings">Extending the ORM: Forging Additional Rings</h4>
<p>The power of ORM comes from its extensibility. You can create additional classes for other tables in your database, each with methods tailored to specific operations. For example, you could create an <code>Order</code> class for managing orders, or an <code>Inventory</code> class for tracking products.</p>
<p>Each class can interact with the others, allowing you to build complex operations while maintaining clear, organized, and reusable code. This modular approach is especially beneficial in larger projects where maintaining hundreds or thousands of lines of SQL would be unwieldy and error-prone.</p>
</section>
<section id="advantages-and-trade-offs-of-orm" class="level4">
<h4 class="anchored" data-anchor-id="advantages-and-trade-offs-of-orm">Advantages and Trade-offs of ORM</h4>
<p>While ORM can greatly simplify database interactions and make your code more maintainable, it’s important to recognize the trade-offs:</p>
<p><strong>Advantages</strong>:</p>
<ul>
<li><strong>Abstraction</strong>: ORM hides the complexity of SQL, making database operations more intuitive.</li>
<li><strong>Modularity</strong>: Code is organized into classes, making it easier to manage and extend.</li>
<li><strong>Reusability</strong>: Methods can be reused across your application, reducing code duplication.</li>
</ul>
<p><strong>Trade-offs</strong>:</p>
<ul>
<li><strong>Performance</strong>: In some cases, ORM may introduce a slight performance overhead compared to writing optimized raw SQL queries.</li>
<li><strong>Complexity</strong>: For very complex queries, the abstraction provided by ORM might make it harder to optimize or understand what’s happening under the hood.</li>
<li><strong>Learning Curve</strong>: If you’re new to object-oriented programming or R6, there may be a learning curve involved.</li>
</ul>
</section>
</section>
<section id="sailing-into-the-west-the-journeys-end-and-new-beginnings" class="level3">
<h3 class="anchored" data-anchor-id="sailing-into-the-west-the-journeys-end-and-new-beginnings">Sailing into the West: The Journey’s End and New Beginnings</h3>
<p>By forging your own ORM with R6 in R, you gain a powerful toolset that brings order to your database interactions, much like the Rings of Power brought structure and control to Middle-earth. With this approach, you can build robust, maintainable, and scalable applications that harness the full potential of both R and SQL.</p>
<p>Just as the journey of the Fellowship in <em>“The Lord of the Rings”</em> eventually led them to the Grey Havens — a place of reflection, peace, and new beginnings — so too does our exploration of SQL in R bring us to a moment of reflection and readiness for future adventures in data analysis.</p>
<p>Throughout this journey, we’ve traversed the vast landscape of SQL and R, discovering how these two powerful tools can be harmonized to achieve greater efficiency, security, and clarity in managing and analyzing data. From the basics of establishing connections to databases, to the intricacies of secure query execution and the elegance of using <code>dbplyr</code> to bridge the gap between R’s tidyverse and SQL’s relational power, you’ve gained the knowledge to wield these tools like the Rings of Power.</p>
<p>We also delved into the challenges of handling large datasets, learning how to keep the heavy lifting on the database server and how to process data in manageable chunks to avoid being overwhelmed. The techniques shared are your tools to stand firm against the Balrog-like challenges that large datasets can pose.</p>
<p>Moreover, we explored the deployment of SQL and R in production environments, ensuring that your workflows are robust, secure, and reliable. With best practices in automation, error handling, and monitoring, you are equipped to ensure that your data pipelines run as smoothly as a well-governed kingdom.</p>
<p>Finally, we embraced the concept of ORM with R6, understanding how to encapsulate database interactions within object-oriented structures, much like forging your own Rings of Power. This approach not only streamlines your database operations but also opens up new possibilities for building scalable, maintainable, and modular applications.</p>
<p>As you sail into the West, leaving behind this foundational journey, remember that the end of one journey is merely the beginning of another. The skills and techniques you’ve acquired here are just the starting points for further exploration, deeper mastery, and more complex challenges. The realms of data are vast and ever-expanding, and with SQL and R by your side, you are well-prepared to venture into new territories, uncover hidden insights, and perhaps, discover your own unique path to data mastery.</p>
<p>So, whether you are analyzing data for business insights, developing data-driven applications, or simply exploring the vast possibilities that R and SQL offer together, may your journey be filled with discovery, growth, and the confidence that comes with knowing you are equipped with the tools to conquer any data challenge that lies ahead.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>For everybody, not to be fooled by numbers</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>